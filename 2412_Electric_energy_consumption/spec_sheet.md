### **PJ：電力消費予測モデル化およびWeb API化**

|        |               |          |     |             |     |
| ------ | ------------- | -------- | --- | ----------- | --- |
| 開始月 | 2024年10月    | チーム人数 |     | 1人        |     |
| 期間   | 1.5ヵ月         |          |     |             |     |
|        |               |          |     |             |     |

|                   |                                                                                            |
| ----------------- | ------------------------------------------------------------------------------------------ |
| 開発環境（OS）              | Windows11                                                                                     |
| 言語              | Python3.12.4                                                                                     |
| Framework/Library | Pandas, Numpy, Statsmodels, Matplotlib, Pmdarima, Scikit-learn, Prophet, LightGBM, Flask |                                                                                          |
| ツール・その他    | Jupyter lab, Visual Studio Code                                                                               |
|                   |                                                                  |
**【概要】**

- **目的**: 東京エリアの2023年の電力消費量を予測すること。
- **利用データ**:
  - 東京エリアの1時間ごとの電力消費量データ（2016年～2023年）。出典：[東京電力パワーグリッド でんき予報](https://www.tepco.co.jp/forecast/html/download-j.html)
  - 1時間ごとの平均気温データ（同上）。出典：[国土交通省 気象庁 過去の気象データ・ダウンロード](https://www.data.jma.go.jp/risk/obsdl/index.php#)

**【データの性質と前処理内容】**

- **train データ、test データの規模**:
  - 学習データ：2016年4月～2022年12月（59,184行）。
  - テストデータ：2023年1月～12月（8,760行）。
- **データの特徴量**:
  - 目的変数：電力消費量（10MW単位）
  - 説明変数：気温（摂氏）、休日（土日祝日および祝日の振替休日を「1」、平日を「0」とするフラグ処理を実施）
- **与えられたデータの課題と改善点**:
  - 複数の周期性（1日単位、1週間単位）が観察される非線形的なデータ特性。
  - 季節性や曜日ごとの消費傾向を反映する特徴量の生成が必要。

**【実装内容・工夫した点】**

1. **前処理**    
   - ホームページよりcsvファイルを取得し、データクレンジングを実施。
   - EDA（探索的データ分析）を通じて、データの周期性を可視化。 
   - 気温データを用い、平均気温からの絶対温度差を新たな特徴量として生成（閾値：18.1℃）。  
   - 国民の祝日および振替休日も考慮したカレンダーデータを作成。  
 
2. **モデル構築**  
   - **古典的時系列分析モデル**:  
     - 性能を確かめるためAMモデルで基本的な予測を実施。
   - **Prophetモデル**:  
     - 季節性を自動調整する能力を活用し、基本的な予測を実施。  
     - 特徴量エンジニアリングを行い、グラフで予測傾向を比較。  
   - **決定木系モデル（ランダムフォレスト、ヒストグラディエントブースティング木、LightGBM）**:  
     - 特徴量重要度を解析し、モデル改善の手がかりを得た。  
     - 学習率、木の本数などのハイパーパラメータを最適化。  
   - **モデル選定の基準と工夫**:  
     - 古典的時系列分析モデルが使えるかどうかをSTF分解やACF、PACFを分析することで考慮。 

3. **モデルの学習と評価**  
   - RMSE（Root Mean Squared Error）とR²（決定係数）を評価指標に採用。  
   - 学習データとテストデータの両方でモデルの予測精度を確認。  
   - グラフ化により、予測値と実測値の相関を評価。

4. **API化とフロントエンドの実装**
   - **Flaskフレームワークを用いたAPI開発**:
     - OST /predict_day: 日付、時間、気温を入力として受け取り、予測結果を返す。
     - 予測結果として、指定時刻の予測値、1日の消費量グラフを生成し、結果をJSON形式で返却。
     - 入力データに気温がない場合でも、過去の同日同時間帯データで補完可能な仕組みを導入。

**【結論】**
   - 今回は、時系列分析モデル、Prophetモデル、決定木系モデルを比較検証し、最も性能が良かったのはProphetモデルに休日フラグと気温の絶対値差分を追加し、さらに残差にLightGBMを適用するアンサンブル手法（テストデータにおける二乗平均平方根誤差: 217.2337、決定係数: 0.9069）。
   - この結果の背景として、Prophetモデルがトレンドや季節要因を自動的に捕捉する能力を発揮し、さらにトレンドや季節要因を除いた非線形の残差をLightGBMが効果的に捉えたことが精度向上につながったと考えられる。
   - 一方で、今回用いた説明変数（気温と休日）だけでは、電力使用量の全てを予測するには不十分であり、湿度や降水量などの気象要因や、新たな社会的要因を説明変数として加えることで、さらなる改善が期待できる。
   - また、現状の手法ではさらなる非線形性の捉え方や長期依存性を十分に扱えていない可能性があるため、改善案として以下を試したい。
     - RNN（再帰型ニューラルネットワーク）やLSTM（長短期記憶）の導入により、時系列データの長期的な傾向を考慮した予測を行う。
     - 深層学習を活用したモデルを用いることで、複雑な要因間の相互作用をより正確に捉える。　以上